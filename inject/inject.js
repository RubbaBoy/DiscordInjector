/* This cool color script part comes from https://gist.github.com/davidgilbertson/6eae478d9a197bfa1b4dfbef38f787e5 I did not create it */

function logColor(color, args) {
    console.log(`%c ${args.join(' ')}`, `color: ${color}`);
}

const log = {
    aliceblue: (...args) => {
        logColor('aliceblue', args)
    },
    antiquewhite: (...args) => {
        logColor('antiquewhite', args)
    },
    aqua: (...args) => {
        logColor('aqua', args)
    },
    aquamarine: (...args) => {
        logColor('aquamarine', args)
    },
    azure: (...args) => {
        logColor('azure', args)
    },
    beige: (...args) => {
        logColor('beige', args)
    },
    bisque: (...args) => {
        logColor('bisque', args)
    },
    black: (...args) => {
        logColor('black', args)
    },
    blanchedalmond: (...args) => {
        logColor('blanchedalmond', args)
    },
    blue: (...args) => {
        logColor('blue', args)
    },
    blueviolet: (...args) => {
        logColor('blueviolet', args)
    },
    brown: (...args) => {
        logColor('brown', args)
    },
    burlywood: (...args) => {
        logColor('burlywood', args)
    },
    cadetblue: (...args) => {
        logColor('cadetblue', args)
    },
    chartreuse: (...args) => {
        logColor('chartreuse', args)
    },
    chocolate: (...args) => {
        logColor('chocolate', args)
    },
    coral: (...args) => {
        logColor('coral', args)
    },
    cornflowerblue: (...args) => {
        logColor('cornflowerblue', args)
    },
    cornsilk: (...args) => {
        logColor('cornsilk', args)
    },
    crimson: (...args) => {
        logColor('crimson', args)
    },
    cyan: (...args) => {
        logColor('cyan', args)
    },
    darkblue: (...args) => {
        logColor('darkblue', args)
    },
    darkcyan: (...args) => {
        logColor('darkcyan', args)
    },
    darkgoldenrod: (...args) => {
        logColor('darkgoldenrod', args)
    },
    darkgray: (...args) => {
        logColor('darkgray', args)
    },
    darkgreen: (...args) => {
        logColor('darkgreen', args)
    },
    darkgrey: (...args) => {
        logColor('darkgrey', args)
    },
    darkkhaki: (...args) => {
        logColor('darkkhaki', args)
    },
    darkmagenta: (...args) => {
        logColor('darkmagenta', args)
    },
    darkolivegreen: (...args) => {
        logColor('darkolivegreen', args)
    },
    darkorange: (...args) => {
        logColor('darkorange', args)
    },
    darkorchid: (...args) => {
        logColor('darkorchid', args)
    },
    darkred: (...args) => {
        logColor('darkred', args)
    },
    darksalmon: (...args) => {
        logColor('darksalmon', args)
    },
    darkseagreen: (...args) => {
        logColor('darkseagreen', args)
    },
    darkslateblue: (...args) => {
        logColor('darkslateblue', args)
    },
    darkslategray: (...args) => {
        logColor('darkslategray', args)
    },
    darkslategrey: (...args) => {
        logColor('darkslategrey', args)
    },
    darkturquoise: (...args) => {
        logColor('darkturquoise', args)
    },
    darkviolet: (...args) => {
        logColor('darkviolet', args)
    },
    deeppink: (...args) => {
        logColor('deeppink', args)
    },
    deepskyblue: (...args) => {
        logColor('deepskyblue', args)
    },
    dimgray: (...args) => {
        logColor('dimgray', args)
    },
    dimgrey: (...args) => {
        logColor('dimgrey', args)
    },
    dodgerblue: (...args) => {
        logColor('dodgerblue', args)
    },
    firebrick: (...args) => {
        logColor('firebrick', args)
    },
    floralwhite: (...args) => {
        logColor('floralwhite', args)
    },
    forestgreen: (...args) => {
        logColor('forestgreen', args)
    },
    fuchsia: (...args) => {
        logColor('fuchsia', args)
    },
    gainsboro: (...args) => {
        logColor('gainsboro', args)
    },
    ghostwhite: (...args) => {
        logColor('ghostwhite', args)
    },
    gold: (...args) => {
        logColor('gold', args)
    },
    goldenrod: (...args) => {
        logColor('goldenrod', args)
    },
    gray: (...args) => {
        logColor('gray', args)
    },
    green: (...args) => {
        logColor('green', args)
    },
    greenyellow: (...args) => {
        logColor('greenyellow', args)
    },
    grey: (...args) => {
        logColor('grey', args)
    },
    honeydew: (...args) => {
        logColor('honeydew', args)
    },
    hotpink: (...args) => {
        logColor('hotpink', args)
    },
    indianred: (...args) => {
        logColor('indianred', args)
    },
    indigo: (...args) => {
        logColor('indigo', args)
    },
    ivory: (...args) => {
        logColor('ivory', args)
    },
    khaki: (...args) => {
        logColor('khaki', args)
    },
    lavender: (...args) => {
        logColor('lavender', args)
    },
    lavenderblush: (...args) => {
        logColor('lavenderblush', args)
    },
    lawngreen: (...args) => {
        logColor('lawngreen', args)
    },
    lemonchiffon: (...args) => {
        logColor('lemonchiffon', args)
    },
    lightblue: (...args) => {
        logColor('lightblue', args)
    },
    lightcoral: (...args) => {
        logColor('lightcoral', args)
    },
    lightcyan: (...args) => {
        logColor('lightcyan', args)
    },
    lightgoldenrodyellow: (...args) => {
        logColor('lightgoldenrodyellow', args)
    },
    lightgray: (...args) => {
        logColor('lightgray', args)
    },
    lightgreen: (...args) => {
        logColor('lightgreen', args)
    },
    lightgrey: (...args) => {
        logColor('lightgrey', args)
    },
    lightpink: (...args) => {
        logColor('lightpink', args)
    },
    lightsalmon: (...args) => {
        logColor('lightsalmon', args)
    },
    lightseagreen: (...args) => {
        logColor('lightseagreen', args)
    },
    lightskyblue: (...args) => {
        logColor('lightskyblue', args)
    },
    lightslategray: (...args) => {
        logColor('lightslategray', args)
    },
    lightslategrey: (...args) => {
        logColor('lightslategrey', args)
    },
    lightsteelblue: (...args) => {
        logColor('lightsteelblue', args)
    },
    lightyellow: (...args) => {
        logColor('lightyellow', args)
    },
    lime: (...args) => {
        logColor('lime', args)
    },
    limegreen: (...args) => {
        logColor('limegreen', args)
    },
    linen: (...args) => {
        logColor('linen', args)
    },
    magenta: (...args) => {
        logColor('magenta', args)
    },
    maroon: (...args) => {
        logColor('maroon', args)
    },
    mediumaquamarine: (...args) => {
        logColor('mediumaquamarine', args)
    },
    mediumblue: (...args) => {
        logColor('mediumblue', args)
    },
    mediumorchid: (...args) => {
        logColor('mediumorchid', args)
    },
    mediumpurple: (...args) => {
        logColor('mediumpurple', args)
    },
    mediumseagreen: (...args) => {
        logColor('mediumseagreen', args)
    },
    mediumslateblue: (...args) => {
        logColor('mediumslateblue', args)
    },
    mediumspringgreen: (...args) => {
        logColor('mediumspringgreen', args)
    },
    mediumturquoise: (...args) => {
        logColor('mediumturquoise', args)
    },
    mediumvioletred: (...args) => {
        logColor('mediumvioletred', args)
    },
    midnightblue: (...args) => {
        logColor('midnightblue', args)
    },
    mintcream: (...args) => {
        logColor('mintcream', args)
    },
    mistyrose: (...args) => {
        logColor('mistyrose', args)
    },
    moccasin: (...args) => {
        logColor('moccasin', args)
    },
    navajowhite: (...args) => {
        logColor('navajowhite', args)
    },
    navy: (...args) => {
        logColor('navy', args)
    },
    oldlace: (...args) => {
        logColor('oldlace', args)
    },
    olive: (...args) => {
        logColor('olive', args)
    },
    olivedrab: (...args) => {
        logColor('olivedrab', args)
    },
    orange: (...args) => {
        logColor('orange', args)
    },
    orangered: (...args) => {
        logColor('orangered', args)
    },
    orchid: (...args) => {
        logColor('orchid', args)
    },
    palegoldenrod: (...args) => {
        logColor('palegoldenrod', args)
    },
    palegreen: (...args) => {
        logColor('palegreen', args)
    },
    paleturquoise: (...args) => {
        logColor('paleturquoise', args)
    },
    palevioletred: (...args) => {
        logColor('palevioletred', args)
    },
    papayawhip: (...args) => {
        logColor('papayawhip', args)
    },
    peachpuff: (...args) => {
        logColor('peachpuff', args)
    },
    peru: (...args) => {
        logColor('peru', args)
    },
    pink: (...args) => {
        logColor('pink', args)
    },
    plum: (...args) => {
        logColor('plum', args)
    },
    powderblue: (...args) => {
        logColor('powderblue', args)
    },
    purple: (...args) => {
        logColor('purple', args)
    },
    red: (...args) => {
        logColor('red', args)
    },
    rosybrown: (...args) => {
        logColor('rosybrown', args)
    },
    royalblue: (...args) => {
        logColor('royalblue', args)
    },
    saddlebrown: (...args) => {
        logColor('saddlebrown', args)
    },
    salmon: (...args) => {
        logColor('salmon', args)
    },
    sandybrown: (...args) => {
        logColor('sandybrown', args)
    },
    seagreen: (...args) => {
        logColor('seagreen', args)
    },
    seashell: (...args) => {
        logColor('seashell', args)
    },
    sienna: (...args) => {
        logColor('sienna', args)
    },
    silver: (...args) => {
        logColor('silver', args)
    },
    skyblue: (...args) => {
        logColor('skyblue', args)
    },
    slateblue: (...args) => {
        logColor('slateblue', args)
    },
    slategray: (...args) => {
        logColor('slategray', args)
    },
    slategrey: (...args) => {
        logColor('slategrey', args)
    },
    snow: (...args) => {
        logColor('snow', args)
    },
    springgreen: (...args) => {
        logColor('springgreen', args)
    },
    steelblue: (...args) => {
        logColor('steelblue', args)
    },
    tan: (...args) => {
        logColor('tan', args)
    },
    teal: (...args) => {
        logColor('teal', args)
    },
    thistle: (...args) => {
        logColor('thistle', args)
    },
    tomato: (...args) => {
        logColor('tomato', args)
    },
    turquoise: (...args) => {
        logColor('turquoise', args)
    },
    violet: (...args) => {
        logColor('violet', args)
    },
    wheat: (...args) => {
        logColor('wheat', args)
    },
    white: (...args) => {
        logColor('white', args)
    },
    whitesmoke: (...args) => {
        logColor('whitesmoke', args)
    },
    yellow: (...args) => {
        logColor('yellow', args)
    },
    yellowgreen: (...args) => {
        logColor('yellowgreen', args)
    },
};


log.darkcyan("Injecting DOM observer...");

var observeDOM = (function () {
    var MutationObserver = window.MutationObserver || window.WebKitMutationObserver,
        eventListenerSupported = window.addEventListener;

    return function (obj, otherObj, removed, added) {
        if (MutationObserver) {
            var obs = new MutationObserver(function (mutations, observer) {
                console.log("Something mutated!");

                // console.log(mutations);
                for (let i2 = 0; i2 < mutations.length; i2++) {
                    if (mutations[i2].addedNodes.length) {
                        let arr = mutations[i2].addedNodes;
                        for (let i = 0; i < arr.length; i++) {
                            for (let i3 = 0; i3 < otherObj.length; i3++) {
                                if (arr[i] && arr[i].classList && arr[i].classList.contains(otherObj[i3])) {
                                    added(arr[i]);
                                }
                            }
                        }
                    }

                    if (mutations[i2].removedNodes.length) {
                        let arr2 = mutations[i2].removedNodes;
                        for (let i = 0; i < arr2.length; i++) {
                            for (let i3 = 0; i3 < otherObj.length; i3++) {
                                if (arr2[i] && arr2[i].classList && arr2[i].classList.contains(otherObj[i3])) {
                                    removed(arr2[i]);
                                }
                            }
                        }
                    }
                }
            });
            // have the observer observe foo for changes in children
            obs.observe(obj, {childList: true, subtree: true});
        }
    };
})();

/*
    Gets the last element clicked when right clicking stuff
 */

let lastClicked = null;

document.addEventListener('contextmenu', function (e) {
    e = e || window.event;
    var target = e.target || e.srcElement,
        text = target.textContent || text.innerText;

    if (target.classList.contains("markup")) {
        console.log(target);
        lastClicked = target;
    }
}, true);


var translateThing = "<div id=\"translate\" class=\"custom-item-group custom-context-menu theme-dark2\" onmousedown='clickedTranslate()' style=\"left: LPX; top: TPX\">\n" +
    "    <div class=\"item2\"><span>Translate</span>\n" +
    "        <div class=\"hint2\"></div>\n" +
    "    </div>\n" +
    "</div>";

function clickedTranslate() {
    let transl = document.getElementById("translate");
    transl.style.display = "none";

    log.green("Clicked translate!");
    if (lastClicked !== null) {
        log.green("##############################################");
        log.green("TRANSLATING:");
        log.red(lastClicked.innerText);

        translateText(lastClicked.innerText, function (translated) {
            lastClicked.innerText = translated;
        });

        log.green("##############################################");
    } else {
        console.red("Error: lastClicked is null!")
    }
}

document.onmousemove = handleMouseMove;
var mousePos;

function handleMouseMove(event) {

    var dot, eventDoc, doc, body, pageX, pageY;

    event = event || window.event; // IE-ism

    if (event.pageX == null && event.clientX != null) {
        eventDoc = (event.target && event.target.ownerDocument) || document;
        doc = eventDoc.documentElement;

        body = eventDoc.body;
        event.pageX = event.clientX +
            (doc && doc.scrollLeft || body && body.scrollLeft || 0) -
            (doc && doc.clientLeft || body && body.clientLeft || 0);
        event.pageY = event.clientY +
            (doc && doc.scrollTop || body && body.scrollTop || 0) -
            (doc && doc.clientTop || body && body.clientTop || 0);

    }
    mousePos = {
        x: event.pageX,
        y: event.pageY
    };


}

var last = 0;

var lastRightClicked = null;
var adding = false;

// Observe a specific DOM element:
observeDOM(document.getElementById("app-mount"), ["context-menu"], function (removed) { /* Executed when element is removed */
    if (lastRightClicked === removed) {
        let transl = document.getElementById("translate");
        transl.style.display = "none";
    }
}, function (added) { /* Executed when element is removed */
    var rightClick = document.getElementsByClassName('context-menu')[0];

    if (rightClick !== null && rightClick !== undefined) {
        log.tomato("User is right clicking!");

        if (rightClick.innerHTML.toString().includes("Message") || rightClick.innerHTML.toString().includes("Reaction") && (!rightClick.innerHTML.toString().includes("Ban") && !rightClick.innerHTML.toString().includes("Kick") && !rightClick.innerHTML.toString().includes("Profile") && !rightClick.innerHTML.toString().includes("Note") && !rightClick.innerHTML.toString().includes("Call") && !rightClick.innerHTML.toString().includes("Block"))) {
            log.darkcyan("Right clicked message.");
            lastRightClicked = rightClick;

            if (!document.body.innerHTML.toString().includes("id=\"translate\"")) {
                rightClick.classList.add("right-click-message");

                let min = document.getElementById("app-mount").firstChild;

                min.innerHTML = min.innerHTML.toString() + translateThing.replace("LPX", rightClick.style.left).replace("TPX", rightClick.style.top);
            } else {
                let transl = document.getElementById("translate");
                transl.style.display = "block";
                transl.style.left = rightClick.style.left;
                transl.style.top = rightClick.style.top;
            }
        }
    } else {
        let transl = document.getElementById("translate");
        transl.style.display = "none";
    }
});


function translateText(text, callback) {
    let yandexKey = "* Your Yandex API key (They are free) *";
    let date = new Date();
    let startTime = date.getTime();
    httpGetAsync("https://translate.yandex.net/api/v1.5/tr.json/detect?key=" + yandexKey + "&hint=sv&text=" + encodeURIComponent(text), function (langJSON) {
        let lang = JSON.parse(langJSON).lang;

        log.blue("Got language: " + lang);

        httpGetAsync("https://translate.yandex.net/api/v1.5/tr.json/translate?key=" + yandexKey + "&lang=" + lang + "-en&text=" + encodeURIComponent(text), function (translatedJSON) {
            let translated = JSON.parse(translatedJSON).text[0];

            let date = new Date();
            let currTime = date.getTime();
            log.blue("(In " + (currTime - startTime) + "ms) Translated to: " + translated);
            callback(translated);
        })
    });
}

function httpGetAsync(theUrl, callback) {
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function () {
        if (xmlHttp.readyState === 4 && xmlHttp.status === 200)
            callback(xmlHttp.responseText);
    };

    xmlHttp.open("GET", theUrl, true);
    xmlHttp.send(null);
}